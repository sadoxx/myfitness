@page "/register"
@using MudBlazor
@using MyFit.Client.Services
@inject ApiService ApiService
@inject NavigationManager Navigation
@inject ISnackbar Snackbar

<PageTitle>Register - MyFit</PageTitle>

<MudContainer MaxWidth="MaxWidth.Small" Class="mt-16">
    <MudPaper Elevation="3" Class="pa-8">
        <MudText Typo="Typo.h4" Align="Align.Center" GutterBottom="true">Create Account</MudText>
        <MudText Typo="Typo.body1" Align="Align.Center" Class="mb-6">Join MyFit today</MudText>
        
        <MudForm @ref="_form">
            <MudTextField @bind-Value="_email" 
                          Label="Email" 
                          Variant="Variant.Outlined" 
                          InputType="InputType.Email"
                          Required="true"
                          Class="mb-4" />
            
            <MudTextField @bind-Value="_password" 
                          Label="Password" 
                          Variant="Variant.Outlined" 
                          InputType="InputType.Password"
                          Required="true"
                          Class="mb-4" />
            
            <MudTextField @bind-Value="_confirmPassword" 
                          Label="Confirm Password" 
                          Variant="Variant.Outlined" 
                          InputType="InputType.Password"
                          Required="true"
                          Class="mb-6" />
            
            <MudButton Variant="Variant.Filled" 
                       Color="Color.Primary" 
                       FullWidth="true" 
                       Size="Size.Large"
                       OnClick="HandleRegister"
                       Disabled="_isLoading">
                @if (_isLoading)
                {
                    <MudProgressCircular Size="Size.Small" Indeterminate="true" />
                }
                else
                {
                    <text>Create Account</text>
                }
            </MudButton>
        </MudForm>
        
        <MudDivider Class="my-6" />
        
        <MudText Typo="Typo.body2" Align="Align.Center">
            Already have an account? 
            <MudLink Href="/login" Color="Color.Primary">Log in</MudLink>
        </MudText>
    </MudPaper>
</MudContainer>

@code {
    private MudForm _form;
    private string _email = "";
    private string _password = "";
    private string _confirmPassword = "";
    private bool _isLoading = false;

    private async Task HandleRegister()
    {
        if (_password != _confirmPassword)
        {
            Snackbar.Add("Passwords do not match", Severity.Error);
            return;
        }

        try
        {
            _isLoading = true;
            var response = await ApiService.RegisterAsync(_email, _password);
            
            if (response.IsSuccess)
            {
                Snackbar.Add("Registration successful! Please log in.", Severity.Success);
                Navigation.NavigateTo("/login");
            }
            else
            {
                Snackbar.Add(response.Message ?? "Registration failed", Severity.Error);
            }
        }
        catch (Exception)
        {
            Snackbar.Add("An error occurred during registration", Severity.Error);
        }
        finally
        {
            _isLoading = false;
        }
    }
}
